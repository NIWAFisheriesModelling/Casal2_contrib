---
  title: "Casal2 MCMC"
output:
  html_vignette: default
vignette: >
  %\VignetteIndexEntry{Casal2MCMC}
%\VignetteEngine{knitr::rmarkdown}
%\VignetteEncoding{UTF-8}
number_sections: false
---

  ```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, warning=FALSE, echo=T, results='hide'}
library(Casal2, warn.conflicts = F)
library(r4Casal2, warn.conflicts = F)
library(reshape2)
library(dplyr)
library(ggplot2)
library(bayesplot)

```

### Introduction
A vignette to show users functions in `r4Casal2` and in the `Casal2` base package for comparing alternative Casal2 model structures.


## Read in models
```{r run_models, fig.width=6, fig.height=4}
cas2_file_name = system.file("extdata", "tabular.log", package = "r4Casal2", mustWork = TRUE)
cas2_tab = extract.tabular(file = cas2_file_name)
```


## Compare model outputs
### selectivities
```{r selectivities, fig.width=6, fig.height=4}
selectivity_df = get_selectivities(cas2_tab)

ggplot(selectivity_df, aes(x = bin, y = selectivity, col = model_label, linetype = model_label)) +
  geom_line(size = 1.5) +
  facet_wrap(~label) +
  labs(x = "Age", y = "Ogive", col = "Model", linetype = "Model")
```

### Derived quantities
```{r dqs, fig.width=6, fig.height=4}
dq_df = get_dqs(models)
dq_df$years = as.numeric(dq_df$years)
ggplot(dq_df, aes(x = years, y = values, col = model_label, linetype = model_label)) +
  geom_line(size = 1.5) +
  facet_wrap(~dq_label) +
  labs(x = "Year", y = "SSB", col = "Model", linetype = "Model")

```

### Recruitment
```{r recruit, fig.width=6, fig.height=4}
recruit_df = get_BH_recruitment(models)
ggplot(recruit_df, aes(x = ycs_years, y = standardised_ycs, col = model_label, linetype = model_label)) +
  geom_line(size = 1.3) +
  labs(x = "YCS year", y = "standardised ycs", col = "Model", linetype = "Model")
```



### Abundance fits
```{r abundance, fig.width=6, fig.height=4}
abundance_obs_df = get_abundance_observations(models)
ggplot(abundance_obs_df, aes(x = year)) +
  geom_point(aes(y = observed), size = 1.4) +
  geom_line(aes(y = expected, col = model_label)) +
  labs(x = "year", y = "Abundance", col = "Model", linetype = "Model") +
  facet_wrap(~observation_label, scales = "free")
```
